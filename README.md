# reproRawNormalization

## Problem Description

This repository demonstrates a discrepancy between the Speakeasy SDK documentation and the actual TypeScript implementation regarding `additionalProperties`.

### The Issue

According to the [Speakeasy documentation on Additional Properties](https://www.speakeasy.com/docs/sdks/customize/data-model/additionalproperties), `additionalProperties` is described as "an internal implementation detail" and the docs state:

> **Important**: `additionalProperties` is an internal implementation detail. Pass objects with all properties directly - the SDK handles serialization and validation automatically.

However, the actual TypeScript SDK generated by Speakeasy **requires** you to use the `additionalProperties` wrapper structure, even though it's supposed to be internal.

### Example

**What the documentation suggests should work:**
```typescript
const event = {
  raw: '127.0.0.1 - - [01/Jan/2024:00:00:00 +0000] "GET /test" 200 1234',
  host: 'localhost',
  sourcetype: 'access_common',
};
```

**What actually works (required by TypeScript types):**
```typescript
const event = {
  raw: '127.0.0.1 - - [01/Jan/2024:00:00:00 +0000] "GET /test" 200 1234',
  additionalProperties: {
    host: 'localhost',
    sourcetype: 'access_common',
  },
};
```

### Technical Details

#### OpenAPI Schema Definition

The OpenAPI schema defines `CriblEvent` with `additionalProperties: true`:

```yaml
CriblEvent:
  type: object
  additionalProperties: true
  properties:
    _raw:
      type: string
  required:
    - _raw
```

According to the [Speakeasy documentation](https://www.speakeasy.com/docs/sdks/customize/data-model/additionalproperties), when `additionalProperties: true` is set, you should be able to pass properties directly:

> **Usage**: Pass objects with all properties directly - the SDK handles serialization and validation automatically.

#### Generated TypeScript Type

However, the generated TypeScript SDK creates a type that requires the `additionalProperties` wrapper:

```typescript
export type CriblEvent = {
  raw: string;
  additionalProperties?: { [k: string]: any } | undefined;
};
```

While the internal transformation does spread `additionalProperties` to the top level in the output (as shown in the schema transformation), the **input type** still requires the `additionalProperties` wrapper, contradicting both:
1. The OpenAPI schema definition (`additionalProperties: true`)
2. The Speakeasy documentation's claim that you can "pass objects with all properties directly"

## Setup

```bash
npm install
# start the server
docker run -d -p 9000:9000 --name cribl-devTest cribl/cribl:4.15.0
# start the client
npm run dev
```

## Run

```bash
npm run dev
```